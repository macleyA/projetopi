<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <title>Adicionar Evento</title>
    <script>
        // Tabela de preços para cada doce
        const precoDoces = {
            "Brigadeiro": 1.50,
            "Beijinho": 1.30,
            "Cajuzinho": 1.20,
            "Bem-casado": 2.00,
            "Torta de Limão": 3.50
        };

        function atualizarPreco() {
            const nomeDoce = document.getElementById("nomeDoce").value;
            const precoCampo = document.getElementById("preco");
            const valorT = document.getElementById("valorT");
            const quantidade = document.getElementById("qtd").value || 1;

            // Atualiza o preço com base no doce selecionado
            if (precoDoces[nomeDoce]) {
                precoCampo.value = precoDoces[nomeDoce].toFixed(2);

                // Atualiza o valor total (preço * quantidade)
                valorT.value = (precoDoces[nomeDoce] * quantidade).toFixed(2);
            } else {
                precoCampo.value = "";
                valorT.value = "";
            }
        }

        function atualizarValorTotal() {
            const preco = parseFloat(document.getElementById("preco").value) || 0;
            const quantidade = parseInt(document.getElementById("qtd").value) || 1;
            const valorT = document.getElementById("valorT");

            // Atualiza o valor total com base na quantidade
            valorT.value = (preco * quantidade).toFixed(2);
        }
    </script>
</head>
<body>
    <div th:replace="~{menu :: menu}"></div>
    <div class="container">
        <h1>Faça seu Pedido</h1>

        <form action="/eventos" method="post" th:object="${evento}">
            <!-- Campo oculto para ID -->
            <input type="hidden" th:field="*{id}" readonly="readonly" />

            <!-- Nome do Doce -->
            <div>
                <label>Nome do doce: </label>
                <input type="text" id="nomeDoce" th:field="*{nome}" placeholder="Selecione ou insira o nome do doce" list="docesDisponiveis" oninput="atualizarPreco()" />
                <datalist id="docesDisponiveis">
                    <option value="Brigadeiro"></option>
                    <option value="Beijinho"></option>
                    <option value="Cajuzinho"></option>
                    <option value="Bem-casado"></option>
                    <option value="Torta de Limão"></option>
                </datalist>
                <p th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}">Erro no campo Nome</p>
            </div>

            <!-- Quantidade -->
            <div>
                <label>Quantidade: </label>
                <input type="number" id="qtd" th:field="*{qtd}" placeholder="Digite a quantidade" min="1" oninput="atualizarValorTotal()" />
                <p th:if="${#fields.hasErrors('qtd')}" th:errors="*{qtd}">Erro no campo Quantidade</p>
            </div>

            <!-- Preço -->
            <div>
                <label>Preço (por unidade): </label>
                <input type="number" id="preco" th:field="*{preco}" placeholder="Preço será preenchido automaticamente" readonly />
                <p th:if="${#fields.hasErrors('preco')}" th:errors="*{preco}">Erro no campo Preço</p>
            </div>

            <!-- Valor Total -->
            <div>
                <label>Valor Total: </label>
                <input type="number" id="valorT" th:field="*{valorT}" placeholder="Valor total será calculado automaticamente" readonly />
                <p th:if="${#fields.hasErrors('valorT')}" th:errors="*{valorT}">Erro no campo Valor Total</p>
            </div>

            <!-- Botões -->
            <div>
                <button class="waves-effect waves-light btn" type="submit">Salvar</button>
                <button class="waves-effect waves-light btn" type="reset">Limpar</button>
            </div>
        </form>
    </div>
</body>
</html>
